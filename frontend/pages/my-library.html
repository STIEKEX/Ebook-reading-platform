<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Library</title>
  <link rel="stylesheet" href="../css/main.css">
</head>
<body>
  <div class="page-wrapper">
    <div class="page-card">
      <div class="page-header">
        <div>
          <div class="page-title">My Library</div>
          <div class="muted">Your saved & favorite books</div>
        </div>
        <div>
          <button class="btn brand" onclick="goHome()">‚Üê Back</button>
        </div>
      </div>

      <div id="libraryContainer"></div>
    </div>
  </div>

  <script src="../js/api.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      if (!isLoggedIn()) {
        window.location.href = 'login.html';
        return;
      }

      const books = await getFavorites();
      const container = document.getElementById('libraryContainer');

      if (books.length === 0) {
        container.innerHTML = '<div class="empty-message">No favorite books yet. Start adding books to your library!</div>';
        return;
      }

      container.innerHTML = '<div class="card-grid">' + books.map(book => `
        <div class="card-item">
          <img src="${book.coverImage}" alt="${book.title}" onclick="readBook('${book._id}')"/>
          <div class="card-body">
            <div style="font-weight:700; margin-bottom:6px;">${book.title}</div>
            <div class="muted" style="font-size:13px; margin-bottom:8px;">${book.author}</div>
            <div style="display:flex; gap:8px;">
              <button class="btn brand" onclick="readBook('${book._id}')">Read</button>
              <button class="btn" style="background:#fff; border:1px solid #f3f4f6;" onclick="removeFavorite('${book._id}')">Remove</button>
            </div>
          </div>
        </div>
      `).join('') + '</div>';
    });

    function readBook(bookId) {
      window.location.href = `reader.html?id=${bookId}`;
    }

    async function removeFavorite(bookId) {
      await toggleFavorite(bookId);
      location.reload();
    }

    function goHome() {
      window.location.href = '../main.html';
    }
  </script>
</body>
</html>
